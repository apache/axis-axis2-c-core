<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <title>Axis2 User's Guide</title>
  <meta name="generator" content="amaya 9.4, see http://www.w3.org/Amaya/">
</head>

<body dir="ltr" lang="en-US">
<h3><a name="Axis2_User's_Guide">Axis2/C User's Guide</a></h3>


<p align="right">Pages: <a href="userguide.html">Content</a>, <a
href="userguide1.html">1</a>, <b>2</b>, <a href="userguide3.html">3</a></p>

<p><strong>User Feedback</strong>: <a
href="mailto:axis-user@ws.apache.org">axis-c-user@ws.apache.org</a> (Please
remember to prefix the subject with [Axis2]). To subscribe to mailing list
see <a href="../mail-lists.html">here.</a></p>

<h2><a name="Web_Service_Clients_Using_Axis2">Web Service Clients Using
Axis2/C</a></h2>

<p>Before we start looking at how to write Web Service clients, it's worth
going through some background information.</p>

<p>Web Services can be used to provide wide range of functionality to the
users ranging from simple, less time consuming  operations such as
"getStockQuote",  to time consuming business services. When we utilize these
Web Services (that is invoke the Web Service using a client application), we
cannot use some simple generic invocation paradigm that suites all the timing
complexities involved in the service operations. For example, if we use a
single transport channel (such as HTTP) to invoke a Web Service with an
IN-OUT operation that take long time to complete, then most of the time we
may end up with "connection time outs". On the other hand, if there are
simultaneous service invocations that  we need to perform from a single
client application, then the use of a "blocking" client API will degrade the
performance of the client application. Similarly there are various other
consequences such as One-Way transports that come in to play when we need
them. Let's try to analyze some common service invocation paradigms.</p>

<p>Many web service engines provide the users with a Blocking and
Non-Blocking client APIs.</p>
<ul>
  <li><p style="margin-bottom: 0in;"><b>Blocking API</b> -Once the service
    invocation is called, the client application hangs and only gets control
    back when the operation completes, that is when the client receives a
    response or a fault. This is the simplest way of invoking a Web Services
    and it also suites many common situations.</p>
  </li>
  <li><p><b>Non-Blocking API </b>- This is a callback or polling based API,
    hence once a service invocation is called, the client application
    immediately gets the control back and the response is retrieved using the
    callback object provided. This approach provides the flexibility to the
    client application to invoke several Web Services simultaneously without
    blocking on the operations already invoked.</p>
  </li>
</ul>

<p>Both these mechanisms work in the API level. Let's name the  asynchronous
behavior that we can get using the <strong>Non-Blocking API</strong> as
<b>API Level Asynchrony.</b></p>

<p>Both these mechanisms use a single transport connection to send the
request and to receive the response. They do not have the capability of using
two separate transport connections, one for the request and the other for the
response (either One-Way of Two-Way). So both these mechanisms fail to
address the problem of long running transactions (the transport connection
may time-out before the operation completes). A possible solution would be to
use <strong>two separate transport connections for request and
response</strong>. The asynchronous behavior that we gain using this solution
can be called <b>Transport Level Asynchrony</b>.</p>

<p>By combining API Level Asynchrony &amp; Transport Level Asynchrony we can
obtain four different invocation patterns for Web Services as shown in the
following table.</p>
<a name="table1"></a>

<table border="1" cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td height="19" width="33%"><p><strong>API
        (Blocking/Non-Blocking)</strong></p>
      </td>
      <td width="33%"><p><strong> Dual Transports (Yes/No)</strong></p>
      </td>
      <td width="33%"><p><strong>Description</strong></p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Blocking</p>
      </td>
      <td width="33%"><p>No</p>
      </td>
      <td width="33%"><p>Simplest and the familiar invocation pattern</p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Non-Blocking</p>
      </td>
      <td width="33%"><p>No</p>
      </td>
      <td width="33%"><p>Using callbacks or polling</p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Blocking</p>
      </td>
      <td width="33%"><p>Yes</p>
      </td>
      <td width="33%"><p>This is useful when the service operation is IN-OUT
        in nature but the transport used is One-Way (e.g. SMTP)</p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Non-Blocking</p>
      </td>
      <td width="33%"><p>Yes</p>
      </td>
      <td width="33%"><p>This is can be used to gain the maximum asynchronous
        behavior. No blocking in the API level and also in the transport
        level</p>
      </td>
    </tr>
  </tbody>
</table>

<p>Axis2/C is designed to provides the user with all these possibilities to
invoke Web Services.</p>

<p>Currently we have implemented the blocking and non-blocking APIs (that is
API level asynchrony). Support for dual transports would be implemented in
the future.</p>

<h3><a name="Writing_Web_Service_Clients_using_Axis2's_Primary_APIs">Writing
Web Service Clients Using Axis2's Primary APIs</a></h3>

<h4><a name="EchoBlockingClient">Echo Blocking Client</a></h4>

<p>Let's see how we can write a client to invoke "echoString" operation of
"echo service" using the simplest blocking invocation. The complete client
code with some explanations within comments is shown below.</p>

<p><font color="#008000">#include &lt;axis2_call.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_om_stax_builder.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_om_document.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_om_node.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_om_element.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_om_text.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_stream.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_log_default.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_error_default.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_xml_reader.h&gt;<br>
</font> <font color="#008000">#include &lt;stdio.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_xml_writer.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_builder.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_envelope.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_body.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_header.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_message.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_header_block.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_fault.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_fault_code.h&gt;<br>
</font> <font color="#008000">#include &lt;axis2_soap_fault_role.h&gt;<br>
</font> <font
color="#008000">#include &lt;platforms/axis2_platform_auto_sense.h&gt;<br>
</font> <br>
<font color="#000000">axis2_om_node_t</font> *<br>
<font color="#000000">build_om_programatically</font>(<font
color="#000000">axis2_env_t</font> **<font color="#000000">env</font>);<br>
<br>
<font color="#800000">int</font> <font color="#000000">main</font>(<font
color="#800000">int</font> <font color="#000000">argc</font>, <font
color="#800000">char</font>** <font color="#000000">argv</font>)<br>
{<br>
    <font color="#000000">axis2_om_node_t</font> *<font
color="#000000">node</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_status_t</font> <font
color="#000000">status</font> = <font
color="#000000">AXIS2_FAILURE</font>;<br>
    <font color="#000000">axis2_env_t</font> *<font
color="#000000">env</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_error_t</font> *<font
color="#000000">error</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_log_t</font> *<font
color="#000000">log</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_allocator_t</font> *<font
color="#000000">allocator</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_char_t</font> *<font
color="#000000">address</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_char_t</font> *<font
color="#000000">wsa_action</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_char_t</font> *<font
color="#000000">client_home</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_om_node_t</font> *<font
color="#000000">ret_node</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_svc_t</font> *<font
color="#000000">svc</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_op_t</font> *<font
color="#000000">op</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_call_t</font> *<font
color="#000000">call</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_msg_ctx_t</font> *<font
color="#000000">msg_ctx</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_mep_client_t</font> *<font
color="#000000">mep_client</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_msg_info_headers_t</font> *<font
color="#000000">msg_info_headers</font> = <font
color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_endpoint_ref_t</font>* <font
color="#000000">endpoint_ref</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_conf_t</font> *<font
color="#000000">conf</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_msg_ctx_t</font> *<font
color="#000000">response_ctx</font> = <font color="#000000">NULL</font>;<br>
    <br>
    <font
color="#808080"><i>/* set up the environment with allocator and log*/</i></font><br>
    <font color="#000000">allocator</font> = <font
color="#000000">axis2_allocator_init</font> (<font
color="#000000">NULL</font>);<br>
    <font color="#000000">error</font> = <font
color="#000000">axis2_error_create</font>(<font
color="#000000">allocator</font>);<br>
    <font color="#000000">log</font> = <font
color="#000000">axis2_log_create</font>(<font
color="#000000">allocator</font>, <font color="#000000">NULL</font>, <font
color="#FF0000">"addr_echo.log"</font>);<br>
    <font color="#000000">env</font> = <font
color="#000000">axis2_env_create_with_error_log</font>(<font
color="#000000">allocator</font>, <font color="#000000">error</font>, <font
color="#000000">log</font>);<br>
    <font color="#000000">env</font>-&gt;<font
color="#000000">log</font>-&gt;<font color="#000000">level</font> = <font
color="#000000">AXIS2_LOG_LEVEL_TRACE</font>;<br>
    <font color="#000000">axis2_error_init</font>();<br>
<br>
    <font
color="#808080"><i>/* Set up deploy folder. It is from the deploy folder, the configuration is picked up <br>
     * using the axis2.xml file.<br>
     * In this sample client_home points to the Axis2/C default deploy folder. The client_home can <br>
     * be different from this folder on your system. For example, you may have a different folder <br>
     *(say, my_client_folder) with its own axis2.xml file. my_client_folder/modules will have the <br>
     * modules that the client uses<br>
     */</i></font><br>
    <font color="#000000">client_home</font> = <font
color="#000000">AXIS2_GETENV</font>(<font
color="#FF0000">"AXIS2C_HOME"</font>);<br>
    <font color="#000000"><b>if</b></font> (!<font
color="#000000">client_home</font>)<br>
        <font color="#000000">client_home</font> = <font
color="#FF0000">"../../deploy"</font>;<br>
    <br>
    <font
color="#808080"><i>/* Set end point reference of echo service */</i></font><br>
    <font color="#000000">address</font> = <font
color="#FF0000">"http://localhost:9090/axis2/services/echo"</font>;<br>
    <font color="#000000">wsa_action</font> = <font
color="#FF0000">"http://localhost:9090/axis2/services/echo/echoString"</font>;<br>
    <font color="#000000"><b>if</b></font> (<font
color="#000000">argc</font> &gt; <font color="#0000FF">1</font> )<br>
        <font color="#000000">address</font> = <font
color="#000000">argv</font>[<font color="#0000FF">1</font>];<br>
    <font color="#000000"><b>if</b></font> (<font
color="#000000">AXIS2_STRCMP</font>(<font
color="#000000">address</font>, <font color="#FF0000">"-h"</font>) == <font
color="#0000FF">0</font>)<br>
    {<br>
        <font color="#000000">printf</font>(<font
color="#FF0000">"Usage : %s [endpoint_url]\n"</font>, <font
color="#000000">argv</font>[<font color="#0000FF">0</font>]);<br>
        <font color="#000000">printf</font>(<font
color="#FF0000">"use -h for help\n"</font>);<br>
        <font color="#000000"><b>return</b></font> <font
color="#0000FF">0</font>;<br>
    }<br>
<br>
    <font color="#000000">printf</font> (<font
color="#FF0000">"Using endpoint : %s\n"</font>, <font
color="#000000">address</font>);<br>
<br>
    <font
color="#808080"><i>/* build the SOAP request message content using OM API.*/</i></font><br>
    <font color="#000000">node</font> = <font
color="#000000">build_om_programatically</font>(&amp;<font
color="#000000">env</font>);<br>
<br>
    <font color="#808080"><i>/* create call struct */</i></font><br>
    <font color="#000000">call</font> = <font
color="#000000">axis2_call_create</font>(&amp;<font
color="#000000">env</font>, <font color="#000000">NULL</font>, <font
color="#000000">client_home</font>);<br>
    <font color="#000000">mep_client</font> = <font
color="#000000">AXIS2_CALL_GET_BASE</font>(<font
color="#000000">call</font>, &amp;<font color="#000000">env</font>);<br>
<br>
    <font
color="#808080"><i>/* Prepare the SOAP envelope, using the SOAP message content to be sent.<br>
     * Get a reference to the message context */</i></font><br>
    <font color="#000000">msg_ctx</font> = <font
color="#000000">AXIS2_MEP_CLIENT_PREPARE_SOAP_ENVELOPE</font>(<font
color="#000000">mep_client</font>, &amp;<font
color="#000000">env</font>, <font color="#000000">node</font>);<br>
<br>
    <font
color="#808080"><i>/* Get the reference to message info headers structure from the message context. <br>
       This can be used to manipulate SOAP header content when using WS-Addressing. */</i></font><br>
    <font color="#000000">msg_info_headers</font> = <font
color="#000000">AXIS2_MSG_CTX_GET_MSG_INFO_HEADERS</font>(<font
color="#000000">msg_ctx</font>, &amp;<font color="#000000">env</font>);<br>
<br>
    <font
color="#808080"><i>/* create an axis2_endpoint_ref_t struct with ERP assigned */</i></font><br>
    <font color="#000000">endpoint_ref</font> = <font
color="#000000">axis2_endpoint_ref_create</font>(&amp;<font
color="#000000">env</font>, <font color="#000000">address</font>);<br>
<br>
    <font
color="#808080"><i>/* Set header parameters, required for WS-Addressing. <br>
     * Required only if you need to make use of WS-Addressing.<br>
     */</i></font><br>
    <font color="#000000">AXIS2_MSG_INFO_HEADERS_SET_TO</font>(<font
color="#000000">msg_info_headers</font>, &amp;<font
color="#000000">env</font>, <font color="#000000">endpoint_ref</font>);<br>
    <font color="#000000">AXIS2_MSG_INFO_HEADERS_SET_ACTION</font>(<font
color="#000000">msg_info_headers</font>, &amp;<font
color="#000000">env</font>, <font color="#000000">wsa_action</font>); <br>
    <br>
    <font color="#000000">AXIS2_CALL_SET_TO</font>(<font
color="#000000">call</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">endpoint_ref</font>);<br>
<br>
    <font
color="#808080"><i>/* Get the configuration context */</i></font><br>
    <font color="#000000">conf</font> = <font
color="#000000">AXIS2_CONF_CTX_GET_CONF</font>(<br>
                            <font
color="#000000">AXIS2_SVC_CTX_GET_CONF_CTX</font>(<br>
                                <font
color="#000000">AXIS2_MEP_CLIENT_GET_SVC_CTX</font>(<font
color="#000000">mep_client</font>, &amp;<font
color="#000000">env</font>), <br>
                                &amp;<font color="#000000">env</font>), <br>
                                &amp;<font color="#000000">env</font>);<br>
<br>
    <font
color="#808080"><i>/* Get the echo service context if it is already loaded to service context*/</i></font><br>
    <font color="#000000">svc</font> = <font
color="#000000">AXIS2_CONF_GET_SVC</font>(<font
color="#000000">conf</font>, &amp;<font color="#000000">env</font>, <font
color="#FF0000">"echo"</font>);<br>
    <font color="#000000"><b>if</b></font> (<font
color="#000000">svc</font>)<br>
    {<br>
        <font color="#000000">op</font> = <font
color="#000000">AXIS2_SVC_GET_OP_WITH_NAME</font>(<font
color="#000000">svc</font>, &amp;<font color="#000000">env</font>, <font
color="#FF0000">"echoString"</font>);<br>
        <font color="#000000"><b>if</b></font> (<font
color="#000000">op</font>)<br>
        {<br>
            <font
color="#000000">AXIS2_OP_SET_MSG_EXCHANGE_PATTERN</font>(<font
color="#000000">op</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">AXIS2_MEP_URI_OUT_IN</font>);<br>
        }<br>
    }<br>
    <font color="#000000"><b>else</b></font><br>
    {<br>
       <font
color="#808080"><i>/* echo service is not in the configuration context. We need to create the <br>
        * operation and add it to service context. Then add service context into <br>
        * configuration context.<br>
        */</i></font><br>
        <font color="#000000">axis2_qname_t</font> *<font
color="#000000">op_qname</font> = <font color="#000000">NULL</font>;<br>
        <font color="#000000">axis2_qname_t</font> *<font
color="#000000">svc_qname</font> = <font
color="#000000">axis2_qname_create</font>(&amp;<font
color="#000000">env</font>, <font color="#FF0000">"echo"</font>, <font
color="#000000">NULL</font>, <font color="#000000">NULL</font>);<br>
        <font color="#000000">svc</font> = <font
color="#000000">axis2_svc_create_with_qname</font>(&amp;<font
color="#000000">env</font>, <font color="#000000">svc_qname</font>);<br>
        <font color="#000000">op_qname</font> = <font
color="#000000">axis2_qname_create</font>(&amp;<font
color="#000000">env</font>, <font color="#FF0000">"echoString"</font>, <font
color="#000000">NULL</font>, <font color="#000000">NULL</font>);<br>
        <font color="#000000">op</font> = <font
color="#000000">axis2_op_create_with_qname</font>(&amp;<font
color="#000000">env</font>, <font color="#000000">op_qname</font>);<br>
        <font color="#000000">AXIS2_OP_SET_MSG_EXCHANGE_PATTERN</font>(<font
color="#000000">op</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">AXIS2_MEP_URI_OUT_IN</font>);<br>
        <font color="#000000">AXIS2_SVC_ADD_OP</font>(<font
color="#000000">svc</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">op</font>);<br>
        <font color="#000000">AXIS2_CONF_ADD_SVC</font>(<font
color="#000000">conf</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">svc</font>);<br>
    }<br>
<br>
    <font color="#000000"><b>if</b></font> (!<font
color="#000000">op</font>)<br>
    {<br>
        <font color="#000000">printf</font>(<font
color="#FF0000">"ERROR: operation not present in service\n"</font>);<br>
        <font color="#000000"><b>return</b></font> -<font
color="#0000FF">1</font>;<br>
    }<br>
<br>
   <font
color="#808080"><i>/* Invoke the operation. Client blocks until the response message comes. <br>
    * Response message gets set in the response message context.<br>
    */</i></font><br>
    <font color="#000000">response_ctx</font> = <font
color="#000000">AXIS2_CALL_INVOKE_BLOCKING</font>(<font
color="#000000">call</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">op</font>, <font color="#000000">msg_ctx</font>);<br>
<br>
    <font color="#000000"><b>if</b></font> (<font
color="#000000">response_ctx</font>)<br>
    {<br>
        <font
color="#808080"><i>/* Get the response SOAP message from response message context */</i></font><br>
        <font color="#000000">axis2_soap_envelope_t</font> *<font
color="#000000">soap_envelope</font> = <font
color="#000000">AXIS2_MSG_CTX_GET_SOAP_ENVELOPE</font>(<font
color="#000000">response_ctx</font>, &amp;<font
color="#000000">env</font>);<br>
        <font color="#000000">ret_node</font> = <font
color="#000000">AXIS2_SOAP_ENVELOPE_GET_BASE_NODE</font>(<font
color="#000000">soap_envelope</font>, &amp;<font
color="#000000">env</font>);<br>
    }<br>
                                                        <br>
    <font color="#000000"><b>if</b></font>(<font
color="#000000">ret_node</font>)<br>
    {<br>
        <font
color="#808080"><i>/* Get the response value from the SOAP message */</i></font><br>
        <font color="#000000">axis2_xml_writer_t</font> *<font
color="#000000">writer</font> = <font color="#000000">NULL</font>;<br>
        <font color="#000000">axis2_om_output_t</font> *<font
color="#000000">om_output</font> = <font color="#000000">NULL</font>;<br>
        <font color="#000000">axis2_char_t</font> *<font
color="#000000">buffer</font> = <font color="#000000">NULL</font>;<br>
        <br>
        <font color="#000000">printf</font>(<font
color="#FF0000">"\necho stub invoke SUCCESSFUL!\n"</font>);<br>
        <font color="#000000">writer</font> = <font
color="#000000">axis2_xml_writer_create_for_memory</font>(&amp;<font
color="#000000">env</font>, <font color="#000000">NULL</font>, <font
color="#000000">AXIS2_TRUE</font>, <font color="#0000FF">0</font>);<br>
        <font color="#000000">om_output</font> = <font
color="#000000">axis2_om_output_create</font> (&amp;<font
color="#000000">env</font>, <font color="#000000">writer</font>);<br>
<br>
        <font color="#000000">AXIS2_OM_NODE_SERIALIZE</font> (<font
color="#000000">ret_node</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">om_output</font>);<br>
        <font color="#000000">buffer</font> = <font
color="#000000">AXIS2_XML_WRITER_GET_XML</font>(<font
color="#000000">writer</font>, &amp;<font color="#000000">env</font>);<br>
        <font color="#000000">printf</font> (<font
color="#FF0000">"\nReceived OM node in XML : %s\n"</font>, <font
color="#000000">buffer</font>);<br>
    }<br>
    <font color="#000000"><b>else</b></font><br>
    {<br>
                <font color="#000000">AXIS2_LOG_ERROR</font>(<font
color="#000000">env</font>-&gt;<font color="#000000">log</font>, <font
color="#000000">AXIS2_LOG_SI</font>, <font
color="#FF0000">"Stub invoke failed: Error code:"</font><br>
                                                <font
color="#FF0000">" %d :: %s"</font>, <font
color="#000000">env</font>-&gt;<font color="#000000">error</font>-&gt;<font
color="#000000">error_number</font>,<br>
                        <font
color="#000000">AXIS2_ERROR_GET_MESSAGE</font>(<font
color="#000000">env</font>-&gt;<font color="#000000">error</font>));<br>
        <font color="#000000">printf</font>(<font
color="#FF0000">"echo stub invoke failed!\n"</font>);<br>
    }<br>
    <br>
    <font color="#000000"><b>if</b></font> (<font
color="#000000">call</font>)<br>
    {<br>
        <font color="#000000">AXIS2_CALL_FREE</font>(<font
color="#000000">call</font>, &amp;<font color="#000000">env</font>);<br>
    }<br>
    <font color="#000000"><b>return</b></font> <font
color="#000000">status</font>;<br>
}<br>
<br>
<font
color="#808080"><i>/* build SOAP request message content using OM */</i></font><br>
<font color="#000000">axis2_om_node_t</font> *<br>
<font color="#000000">build_om_programatically</font>(<font
color="#000000">axis2_env_t</font> **<font color="#000000">env</font>)<br>
{<br>
    <font color="#000000">axis2_om_node_t</font> *<font
color="#000000">echo_om_node</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_om_element_t</font>* <font
color="#000000">echo_om_ele</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_om_node_t</font>* <font
color="#000000">text_om_node</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_om_element_t</font> * <font
color="#000000">text_om_ele</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_om_namespace_t</font> *<font
color="#000000">ns1</font> = <font color="#000000">NULL</font>;<br>
    <br>
<br>
    <font color="#000000">axis2_xml_writer_t</font> *<font
color="#000000">xml_writer</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_om_output_t</font> *<font
color="#000000">om_output</font> = <font color="#000000">NULL</font>;<br>
    <font color="#000000">axis2_char_t</font> *<font
color="#000000">buffer</font> = <font color="#000000">NULL</font>;<br>
<br>
    <font color="#000000">ns1</font> = <font
color="#000000">axis2_om_namespace_create</font> (<font
color="#000000">env</font>, <font
color="#FF0000">"http://localhost:9090/axis2/services/echo"</font>, <font
color="#FF0000">"ns1"</font>);<br>
<br>
    <font color="#000000">echo_om_ele</font> = <font
color="#000000">axis2_om_element_create</font>(<font
color="#000000">env</font>, <font color="#000000">NULL</font>, <font
color="#FF0000">"echoString"</font>, <font
color="#000000">ns1</font>, &amp;<font
color="#000000">echo_om_node</font>);<br>
    <br>
    <font color="#000000">text_om_ele</font> = <font
color="#000000">axis2_om_element_create</font>(<font
color="#000000">env</font>, <font color="#000000">echo_om_node</font>, <font
color="#FF0000">"text"</font>, <font color="#000000">NULL</font>, &amp;<font
color="#000000">text_om_node</font>);<br>
<br>
    <font color="#000000">AXIS2_OM_ELEMENT_SET_TEXT</font>(<font
color="#000000">text_om_ele</font>, <font color="#000000">env</font>, <font
color="#FF0000">"echo5"</font>, <font
color="#000000">text_om_node</font>);<br>
    <br>
    <br>
    <font color="#000000">xml_writer</font> = <font
color="#000000">axis2_xml_writer_create_for_memory</font>(<font
color="#000000">env</font>, <font color="#000000">NULL</font>, <font
color="#000000">AXIS2_FALSE</font>, <font
color="#000000">AXIS2_FALSE</font>);<br>
    <font color="#000000">om_output</font> = <font
color="#000000">axis2_om_output_create</font>( <font
color="#000000">env</font>, <font color="#000000">xml_writer</font>);<br>
    <br>
    <font color="#000000">AXIS2_OM_NODE_SERIALIZE</font>(<font
color="#000000">echo_om_node</font>, <font color="#000000">env</font>, <font
color="#000000">om_output</font>);<br>
    <font color="#000000">buffer</font> = <font
color="#000000">AXIS2_XML_WRITER_GET_XML</font>(<font
color="#000000">xml_writer</font>, <font
color="#000000">env</font>);         <br>
    <font color="#000000">printf</font>(<font
color="#FF0000">"\nSending OM node in XML : %s \n"</font>,  <font
color="#000000">buffer</font>); <br>
<br>
    <font color="#000000"><b>return</b></font> <font
color="#000000">echo_om_node</font>;<br>
}<br>
</p>

<h4><a name="Request_SOAP_Message">Request SOAP Message</a></h4>
<pre class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"&gt;
      &lt;soapenv:Header xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing"&gt;
         &lt;wsa:To&gt;http://localhost:9090/axis2/services/echo/echo&lt;/wsa:To&gt;
         &lt;wsa:Action&gt;http://127.0.0.1:9090/axis2/services/echo/echoString&lt;/wsa:Action&gt;
         &lt;wsa:ReplyTo&gt;
            &lt;wsa:Address&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/wsa:Address&gt;
         &lt;/wsa:ReplyTo&gt;
         &lt;wsa:ReferenceProperties&gt;&lt;/wsa:ReferenceProperties&gt;
         &lt;wsa:MessageID&gt;325699d4-a438-1da1-3e0b-001125b4e529&lt;/wsa:MessageID&gt;
      &lt;/soapenv:Header&gt;
      &lt;soapenv:Body&gt;
         &lt;ns1:echoString xmlns:ns1="http://localhost:9090/axis2/services/echo"&gt;
            &lt;text&gt;Hello World!&lt;/text&gt;
         &lt;/ns1:echoString&gt;
      &lt;/soapenv:Body&gt;
   &lt;/soapenv:Envelope&gt;</pre>

<h4><a name="Response_SOAP_Message">Response SOAP Message</a></h4>
<pre class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"&gt;
      &lt;soapenv:Header xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing"&gt;
         &lt;wsa:To&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/wsa:To&gt;
         &lt;wsa:Action&gt;http://127.0.0.1:9090/axis2/services/echo/echoString&lt;/wsa:Action&gt;
         &lt;wsa:ReplyTo&gt;
            &lt;wsa:Address&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/wsa:Address&gt;
         &lt;/wsa:ReplyTo&gt;
         &lt;wsa:ReferenceProperties&gt;&lt;/wsa:ReferenceProperties&gt;
         &lt;wsa:From&gt;
            &lt;wsa:Address&gt;http://localhost:9090/axis2/services/echo/echo&lt;/wsa:Address&gt;
         &lt;/wsa:From&gt;
         &lt;wsa:ReferenceProperties&gt;&lt;/wsa:ReferenceProperties&gt;
         &lt;wsa:MessageID&gt;326a1946-a438-1da1-2b95-001125b4e529&lt;/wsa:MessageID&gt;
         &lt;wsa:RelatesTo wsa:RelationshipType="wsa:Reply"&gt;325699d4-a438-1da1-3e0b-001125b4e529&lt;/wsa:RelatesTo&gt;
      &lt;/soapenv:Header&gt;
      &lt;soapenv:Body&gt;
         &lt;ns1:echoString xmlns:ns1="http://localhost:9090/axis2/services/echo"&gt;
            &lt;text&gt;Hello World!&lt;/text&gt;
         &lt;/ns1:echoString&gt;
      &lt;/soapenv:Body&gt;
   &lt;/soapenv:Envelope&gt;</pre>
<br>


<h4>Echo NonBlocking Client</h4>

<p>In the Echo Blocking Client exmple above, once the
"axis2_echo_stub_echo(stub, &amp;env, node);" is called, the client is
blocked till the operation is completed. This behavior is not desirable when
there are many Web Service invocations to be done in a single client
application. A solution would be to use a Non-Blocking API to invoke web
services. Axis2 provides a callback based non-blocking API for users.</p>

<p>A Sample demonstrating this senario can be found in the
samples/client/echo_non_blocking folder. </p>

<p>Before we look at the code changes to the Echo Blocking Client, let's get
a feel of how it works. You need to follow the following steps.<br>
<ul>
<li>
Create a callback instance using
<font face="Monospace">axis2_callback_create(axis2_env_t*)</font>.</li>
<li> Define your own on_complete function and set it to the callback object using the macro <font face="Monospace">AXIS2_CALLBACK_SET_ON_COMPLETE(axis2_callback_t *, on_complete_func_ptr).</font> <br> Your callback function should follow the following signature.<br>
axis2_status_t your_function(axis2_callback *, axis2_env_t **);<br>
A typedef for this function, <font face="Monospace">on_complete_func_ptr</font> is defined in axis2_callback.h.
</li>
<li> Define your own on_error callback function and set it to the callback object using the macro <font face="Monospace">AXIS2_CALLBACK_SET_ON_ERROR(axis2_callback_t *, on_error_func_ptr).</font> <br> Your callback function should follow the following signature. <br>
<font face="Monospace">axis2_status_t your_function(axis2_callback_t *, axis2_env_t **, int);</font><br>
A typedef for this function, <font face="Monospace">on_error_func_ptr</font> is defined in axis2_callback.h.
</li>
<li> Call the macro<br>
<font face="Monospace">AXIS2_CALL_INVOKE_NON_BLOCKING(axis2_call_t*, axis2_env_t**,
axis2_msg_ctx_t*, axis2_callback_t*) </font><br>to access the operation in asyncronous fashion. 
</li>
<li> That's all you need to do to invoke the web service. Now you need to flesh out your on_complete callback function to do whatever you want to do with the response message.<br>
You can access the SOAP response message using the following macro. <br>
<font face="Monospace">AXIS2_CALLBACK_GET_ENVELOPE(axis2_callback_t*,
axis2_env_t**);</font>
</li>
</ul></p>

<p></p>

<p>You need to primarily replace the following portion of code in the Echo
Blocking Client</p>

<p><font face="Monospace">    stub = <font
color="#000000">axis2_stub_create_with_endpoint_uri_and_client_home</font>(&amp;<font
color="#000000">env</font>, <font color="#000000">address</font>,<br>
        <font color="#000000">client_home</font>);<br>
    <font color="#000000">AXIS2_STUB_SET_TRANSPORT_INFO</font>(<font
color="#000000">stub</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">AXIS2_TRANSPORT_HTTP</font>, <br>
        <font color="#000000">AXIS2_TRANSPORT_HTTP</font>, <font
color="#000000">AXIS2_FALSE</font>);<br>
    <font color="#000000">AXIS2_STUB_SET_SOAP_VERSION</font>(<font
color="#000000">stub</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">AXIS2_SOAP_11</font>);<br>
    <font color="#808080"><i>/* create node and invoke echo */</i></font><br>
    <font color="#000000">ret_node</font> = <font
color="#000000">axis2_echo_stub_echo</font>(<font
color="#000000">stub</font>, &amp;<font color="#000000">env</font>, <font
color="#000000">node</font>);</font></p>

<p></p>

<p>to the following (note that you need to create an instance of
<font face="Monospace">axis2_callback_t</font>).</p>

<p></p>

<p><font face="Monospace">
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/*&nbsp;create&nbsp;the&nbsp;callback&nbsp;object&nbsp;with&nbsp;default<br>
&nbsp;&nbsp;&nbsp;&nbsp;on_complete&nbsp;and&nbsp;on_error&nbsp;callback&nbsp;functions*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">callback</font>&nbsp;=&nbsp;<font color="#000000">axis2_callback_create</font>(&amp;<font color="#000000">env</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/*&nbsp;set&nbsp;our&nbsp;on_complete&nbsp;fucntion&nbsp;pointer&nbsp;to&nbsp;the&nbsp;callback&nbsp;object&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_CALLBACK_SET_ON_COMPLETE</font>(<font color="#000000">callback</font>,&nbsp;<font color="#000000">my_on_complete</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/*&nbsp;set&nbsp;our&nbsp;on_error&nbsp;function&nbsp;pointer&nbsp;to&nbsp;the&nbsp;callback&nbsp;object&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_CALLBACK_SET_ON_ERROR</font>(<font color="#000000">callback</font>,&nbsp;<font color="#000000">my_on_error</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/*&nbsp;invoke&nbsp;the&nbsp;operation&nbsp;and&nbsp;get&nbsp;the&nbsp;control&nbsp;back&nbsp;to&nbsp;the&nbsp;main<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program&nbsp;immediately&nbsp;(without&nbsp;blocking)*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_CALL_INVOKE_NON_BLOCKING</font>(<font color="#000000">call</font>,&nbsp;&amp;<font color="#000000">env</font>,&nbsp;<font color="#000000">op</font>,&nbsp;<font color="#000000">msg_ctx</font>,&nbsp;<font color="#000000">callback</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font color="#FF0000">&quot;Non&nbsp;blocking&nbsp;call&nbsp;invoked&nbsp;-&nbsp;Control&nbsp;back&nbsp;to&nbsp;Main&nbsp;Program\n&quot;</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/**&nbsp;this&nbsp;is&nbsp;simply&nbsp;to&nbsp;keep&nbsp;the&nbsp;parent&nbsp;thread&nbsp;running<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;until&nbsp;our&nbsp;on_complete&nbsp;or&nbsp;on_error&nbsp;is&nbsp;invoked<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>while</b></font>(<font color="#0000FF">1</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(<font color="#000000">isComplete</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/*&nbsp;we&nbsp;are&nbsp;done&nbsp;with&nbsp;the&nbsp;callback&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>break</b></font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
		</font></p>

<p>    

<p> You need to impletement your own on_complete and on_error functions to handle callbacks. A sample implementation is shwon below.</p>
<p><font face="Monospace">
<font color="#000000">axis2_status_t</font>&nbsp;<br>
<font color="#000000">my_on_complete</font>(<font color="#000000"><b>struct</b></font>&nbsp;<font color="#000000">axis2_callback</font>&nbsp;*<font color="#000000">callback</font>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_env_t</font>&nbsp;**<font color="#000000">env</font>)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/**&nbsp;SOAP&nbsp;response&nbsp;has&nbsp;arrived&nbsp;here;&nbsp;get&nbsp;the&nbsp;soap&nbsp;envelope&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;callback&nbsp;object&nbsp;and&nbsp;do&nbsp;whatever&nbsp;you&nbsp;want&nbsp;to&nbsp;do&nbsp;with&nbsp;it&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_soap_envelope_t</font>&nbsp;*<font color="#000000">soap_envelope</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_om_node_t</font>&nbsp;*<font color="#000000">ret_node</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_xml_writer_t</font>&nbsp;*<font color="#000000">writer</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_om_output_t</font>&nbsp;*<font color="#000000">om_output</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_char_t</font>&nbsp;*<font color="#000000">buffer</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font color="#FF0000">&quot;inside&nbsp;on_complete_callback&nbsp;function\n&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">soap_envelope</font>&nbsp;=&nbsp;<font color="#000000">AXIS2_CALLBACK_GET_ENVELOPE</font>(<font color="#000000">callback</font>,&nbsp;<font color="#000000">env</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(!<font color="#000000">soap_envelope</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_LOG_ERROR</font>((*<font color="#000000">env</font>)-&gt;<font color="#000000">log</font>,&nbsp;<font color="#000000">AXIS2_LOG_SI</font>,&nbsp;<font color="#FF0000">&quot;Stub&nbsp;invoke&nbsp;FAILED:&nbsp;Error&nbsp;code:&quot;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#FF0000">&quot;&nbsp;%d&nbsp;::&nbsp;%s&quot;</font>,&nbsp;(*<font color="#000000">env</font>)-&gt;<font color="#000000">error</font>-&gt;<font color="#000000">error_number</font>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_ERROR_GET_MESSAGE</font>((*<font color="#000000">env</font>)-&gt;<font color="#000000">error</font>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font color="#FF0000">&quot;echo&nbsp;stub&nbsp;invoke&nbsp;FAILED!\n&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>return</b></font>&nbsp;<font color="#000000">AXIS2_FAILURE</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">ret_node</font>&nbsp;=&nbsp;<font color="#000000">AXIS2_SOAP_ENVELOPE_GET_BASE_NODE</font>(<font color="#000000">soap_envelope</font>,&nbsp;<font color="#000000">env</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>(!<font color="#000000">ret_node</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_LOG_ERROR</font>((*<font color="#000000">env</font>)-&gt;<font color="#000000">log</font>,&nbsp;<font color="#000000">AXIS2_LOG_SI</font>,&nbsp;<font color="#FF0000">&quot;Stub&nbsp;invoke&nbsp;FAILED:&nbsp;Error&nbsp;code:&quot;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#FF0000">&quot;&nbsp;%d&nbsp;::&nbsp;%s&quot;</font>,&nbsp;(*<font color="#000000">env</font>)-&gt;<font color="#000000">error</font>-&gt;<font color="#000000">error_number</font>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_ERROR_GET_MESSAGE</font>((*<font color="#000000">env</font>)-&gt;<font color="#000000">error</font>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font color="#FF0000">&quot;echo&nbsp;stub&nbsp;invoke&nbsp;FAILED!\n&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>return</b></font>&nbsp;<font color="#000000">AXIS2_FAILURE</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/*we&nbsp;just&nbsp;serialize&nbsp;the&nbsp;SOAP&nbsp;message&nbsp;and&nbsp;output&nbsp;to&nbsp;stdout&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font color="#FF0000">&quot;\necho&nbsp;stub&nbsp;invoke&nbsp;SUCCESSFUL!\n&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">writer</font>&nbsp;=&nbsp;<font color="#000000">axis2_xml_writer_create_for_memory</font>(<font color="#000000">env</font>,&nbsp;<font color="#000000">NULL</font>,&nbsp;<font color="#000000">AXIS2_TRUE</font>,&nbsp;<font color="#0000FF">0</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">om_output</font>&nbsp;=&nbsp;<font color="#000000">axis2_om_output_create</font>&nbsp;(<font color="#000000">env</font>,&nbsp;<font color="#000000">writer</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_OM_NODE_SERIALIZE</font>&nbsp;(<font color="#000000">ret_node</font>,&nbsp;<font color="#000000">env</font>,&nbsp;<font color="#000000">om_output</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">buffer</font>&nbsp;=&nbsp;<font color="#000000">AXIS2_XML_WRITER_GET_XML</font>(<font color="#000000">writer</font>,&nbsp;<font color="#000000">env</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>&nbsp;(<font color="#FF0000">&quot;\nReceived&nbsp;OM&nbsp;node&nbsp;in&nbsp;XML&nbsp;:&nbsp;%s\n&quot;</font>,&nbsp;<font color="#000000">buffer</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_OM_OUTPUT_FREE</font>(<font color="#000000">om_output</font>,&nbsp;<font color="#000000">env</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_FREE</font>((*<font color="#000000">env</font>)-&gt;<font color="#000000">allocator</font>,&nbsp;<font color="#000000">buffer</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">isComplete</font>&nbsp;=&nbsp;<font color="#0000FF">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>return</b></font>&nbsp;<font color="#000000">AXIS2_SUCCESS</font>;<br>
}<br>
<br>
<font color="#000000">axis2_status_t</font>&nbsp;<br>
<font color="#000000">my_on_error</font>(<font color="#000000"><b>struct</b></font>&nbsp;<font color="#000000">axis2_callback</font>&nbsp;*<font color="#000000">callback</font>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_env_t</font>&nbsp;**<font color="#000000">env</font>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#800000">int</font>&nbsp;<font color="#000000">exception</font>)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/**&nbsp;take&nbsp;necessary&nbsp;action&nbsp;on&nbsp;error&nbsp;*/</i></font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font color="#FF0000">&quot;my&nbsp;on_error&nbsp;error&nbsp;code:%d&nbsp;::%s&quot;</font>,&nbsp;<font color="#000000">exception</font>,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_ERROR_GET_MESSAGE</font>((*<font color="#000000">env</font>)-&gt;<font color="#000000">error</font>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">isComplete</font>&nbsp;=&nbsp;<font color="#0000FF">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>return</b></font>&nbsp;<font color="#000000">AXIS2_SUCCESS</font>;<br>
}<br>
<br>
		</font></p>
<p> There are situation where you may need to keep data pertaining to each callback you make. You can make use of the following macros in such situations.<br>
<font face="Monospace">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_CALLBACK_SET_DATA</font>(<font color="#000000">axis2_callback_t</font>&nbsp;*,&nbsp;<font color="#800000">void</font>&nbsp;*);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_CALLBACK_GET_DATA</font>(<font color="#000000">axis2_callback_t</font>&nbsp;*);<br>
		</font><br><br>
Please refer to the sample shipped with the release to see the complete working code.
</p>
<p align="right"><a href="userguide1.html"><img src="images/arrow_left.gif">
Previous</a> | <a href="userguide3.html">Next <img
src="images/arrow_right.gif"></a></p>

<p>Pages: <a href="userguide.html">Content</a>, <a
href="userguide1.html">1</a>, <b>2</b>, <a href="userguide3.html">3</a></p>
</body>
</html>
