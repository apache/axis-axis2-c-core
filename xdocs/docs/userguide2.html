<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <title>Axis2 User's Guide</title>
  <meta name="generator" content="amaya 8.5, see http://www.w3.org/Amaya/">
</head>

<body dir="ltr" lang="en-US">
<h3><a name="Axis2_User's_Guide">Axis2/C User's Guide</a></h3>

<h4>-Milestone Release 0.5</h4>

<p align="right">Pages: <a href="userguide.html">Content</a>, <a
href="userguide1.html">1</a>, <b>2</b>, <a href="userguide3.html">3</a></p>

<p><strong>User Feedback</strong>: <a
href="mailto:axis-user@ws.apache.org">axis-c-user@ws.apache.org</a> (Please
remember to prefix the subject with [Axis2]). To subscribe to mailing list
see <a href="../mail-lists.html">here.</a></p>

<h2><a name="Web_Service_Clients_Using_Axis2">Web Service Clients Using
Axis2/C</a></h2>

<p>Before we start looking at how to write Web Service clients, it's worth
going through some background information.</p>

<p>Web Services can be used to provide wide range of functionality to the
users ranging from simple, less time consuming&nbsp; operations such as
"getStockQuote",&nbsp; to time consuming business services. When we utilize
these Web Services (that is invoke the Web Service using a client
application), we cannot use some simple generic invocation paradigm that
suites all the timing complexities involved in the service operations. For
example, if we use a single transport channel (such as HTTP) to invoke a Web
Service with an IN-OUT operation that take long time to complete, then most
of the time we may end up with "connection time outs". On the other hand, if
there are simultaneous service invocations that&nbsp; we need to perform from
a single client application, then the use of a "blocking" client API will
degrade the performance of the client application. Similarly there are
various other consequences such as One-Way transports that come in to play
when we need them. Let's try to analyze some common service invocation
paradigms.</p>

<p>Many web service engines provide the users with a Blocking and
Non-Blocking client APIs.</p>
<ul>
  <li><p style="margin-bottom: 0in;"><b>Blocking API</b> -Once the service
    invocation is called, the client application hangs and only gets control
    back when the operation completes, that is when the client receives a
    response or a fault. This is the simplest way of invoking a Web Services
    and it also suites many common situations.</p>
  </li>
  <li><p><b>Non-Blocking API </b>- This is a callback or polling based API,
    hence once a service invocation is called, the client application
    immediately gets the control back and the response is retrieved using the
    callback object provided. This approach provides the flexibility to the
    client application to invoke several Web Services simultaneously without
    blocking on the operations already invoked.</p>
  </li>
</ul>

<p>Both these mechanisms work in the API level. Let's name the&nbsp;
asynchronous behavior that we can get using the <strong>Non-Blocking
API</strong> as <b>API Level Asynchrony.</b></p>

<p>Both these mechanisms use a single transport connection to send the
request and to receive the response. They do not have the capability of using
two separate transport connections, one for the request and the other for the
response (either One-Way of Two-Way). So both these mechanisms fail to
address the problem of long running transactions (the transport connection
may time-out before the operation completes). A possible solution would be to
use <strong>two separate transport connections for request and
response</strong>. The asynchronous behavior that we gain using this solution
can be called <b>Transport Level Asynchrony</b>.</p>

<p>By combining API Level Asynchrony &amp; Transport Level Asynchrony we can
obtain four different invocation patterns for Web Services as shown in the
following table.</p>
<a name="table1"></a>

<table border="1" cellpadding="0" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td height="19" width="33%"><p><strong>API
        (Blocking/Non-Blocking)</strong></p>
      </td>
      <td width="33%"><p><strong>&nbsp;Dual Transports (Yes/No)</strong></p>
      </td>
      <td width="33%"><p><strong>Description</strong></p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Blocking</p>
      </td>
      <td width="33%"><p>No</p>
      </td>
      <td width="33%"><p>Simplest and the familiar invocation pattern</p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Non-Blocking</p>
      </td>
      <td width="33%"><p>No</p>
      </td>
      <td width="33%"><p>Using callbacks or polling</p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Blocking</p>
      </td>
      <td width="33%"><p>Yes</p>
      </td>
      <td width="33%"><p>This is useful when the service operation is IN-OUT
        in nature but the transport used is One-Way (e.g. SMTP)</p>
      </td>
    </tr>
    <tr>
      <td height="19" width="33%"><p>Non-Blocking</p>
      </td>
      <td width="33%"><p>Yes</p>
      </td>
      <td width="33%"><p>This is can be used to gain the maximum asynchronous
        behavior. No blocking in the API level and also in the transport
        level</p>
      </td>
    </tr>
  </tbody>
</table>

<p>Axis2/C is designed to provides the user with all these possibilities to
invoke Web Services.</p>

<p>Currently we have implemented the blocking and non-blocking APIs (that is
API level asynchrony). Support for dual transports would be implemented in
the future.</p>

<h3><a name="Writing_Web_Service_Clients_using_Axis2's_Primary_APIs">Writing
Web Service Clients Using Axis2's Primary APIs</a></h3>

<h4><a name="EchoBlockingClient">Echo Blocking Client</a></h4>

<p>Let's see how we can write a client to invoke "echoString" operation of
"echo service" using the simplest blocking invocation. The complete client
code with some explanations within comments is shown below.</p>

<p><font color="#008000">#include&nbsp;&lt;axis2_call.h&gt;<br>
</font> <font
color="#008000">#include&nbsp;&lt;axis2_om_stax_builder.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_om_document.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_om_node.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_om_element.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_om_text.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_stream.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_log_default.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_error_default.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_xml_reader.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;stdio.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_xml_writer.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_soap_builder.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_soap.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_soap_envelope.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_soap_body.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_soap_header.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_soap_message.h&gt;<br>
</font> <font
color="#008000">#include&nbsp;&lt;axis2_soap_header_block.h&gt;<br>
</font> <font color="#008000">#include&nbsp;&lt;axis2_soap_fault.h&gt;<br>
</font> <font
color="#008000">#include&nbsp;&lt;axis2_soap_fault_code.h&gt;<br>
</font> <font
color="#008000">#include&nbsp;&lt;axis2_soap_fault_role.h&gt;<br>
</font> <font
color="#008000">#include&nbsp;&lt;platforms/axis2_platform_auto_sense.h&gt;<br>
</font> <br>
<font color="#000000">axis2_om_node_t</font>&nbsp;*<br>
<font color="#000000">build_om_programatically</font>(<font
color="#000000">axis2_env_t</font>&nbsp;**<font
color="#000000">env</font>);<br>
<br>
<font color="#800000">int</font>&nbsp;<font color="#000000">main</font>(<font
color="#800000">int</font>&nbsp;<font color="#000000">argc</font>,&nbsp;<font
color="#800000">char</font>**&nbsp;<font color="#000000">argv</font>)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_node_t</font>&nbsp;*<font
color="#000000">node</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_status_t</font>&nbsp;<font
color="#000000">status</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_FAILURE</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_env_t</font>&nbsp;*<font
color="#000000">env</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_error_t</font>&nbsp;*<font
color="#000000">error</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_log_t</font>&nbsp;*<font
color="#000000">log</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_allocator_t</font>&nbsp;*<font
color="#000000">allocator</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_char_t</font>&nbsp;*<font
color="#000000">address</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_char_t</font>&nbsp;*<font
color="#000000">wsa_action</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_char_t</font>&nbsp;*<font
color="#000000">client_home</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_node_t</font>&nbsp;*<font
color="#000000">ret_node</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_svc_t</font>&nbsp;*<font
color="#000000">svc</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_op_t</font>&nbsp;*<font
color="#000000">op</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_call_t</font>&nbsp;*<font
color="#000000">call</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_msg_ctx_t</font>&nbsp;*<font
color="#000000">msg_ctx</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_mep_client_t</font>&nbsp;*<font
color="#000000">mep_client</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_msg_info_headers_t</font>&nbsp;*<font
color="#000000">msg_info_headers</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_endpoint_ref_t</font>*&nbsp;<font
color="#000000">endpoint_ref</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_conf_t</font>&nbsp;*<font
color="#000000">conf</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_msg_ctx_t</font>&nbsp;*<font
color="#000000">response_ctx</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;set&nbsp;up&nbsp;the&nbsp;environment&nbsp;with&nbsp;allocator&nbsp;and&nbsp;log*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">allocator</font>&nbsp;=&nbsp;<font
color="#000000">axis2_allocator_init</font>&nbsp;(<font
color="#000000">NULL</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>&nbsp;=&nbsp;<font
color="#000000">axis2_error_create</font>(<font
color="#000000">allocator</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">log</font>&nbsp;=&nbsp;<font
color="#000000">axis2_log_create</font>(<font
color="#000000">allocator</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;<font
color="#FF0000">"addr_echo.log"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">env</font>&nbsp;=&nbsp;<font
color="#000000">axis2_env_create_with_error_log</font>(<font
color="#000000">allocator</font>,&nbsp;<font
color="#000000">error</font>,&nbsp;<font color="#000000">log</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">env</font>-&gt;<font
color="#000000">log</font>-&gt;<font
color="#000000">level</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_LOG_LEVEL_TRACE</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_error_init</font>();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Set&nbsp;up&nbsp;deploy&nbsp;folder.&nbsp;It&nbsp;is&nbsp;from&nbsp;the&nbsp;deploy&nbsp;folder,&nbsp;the&nbsp;configuration&nbsp;is&nbsp;picked&nbsp;up&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;using&nbsp;the&nbsp;axis2.xml&nbsp;file.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;In&nbsp;this&nbsp;sample&nbsp;client_home&nbsp;points&nbsp;to&nbsp;the&nbsp;Axis2/C&nbsp;default&nbsp;deploy&nbsp;folder.&nbsp;The&nbsp;client_home&nbsp;can&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;be&nbsp;different&nbsp;from&nbsp;this&nbsp;folder&nbsp;on&nbsp;your&nbsp;system.&nbsp;For&nbsp;example,&nbsp;you&nbsp;may&nbsp;have&nbsp;a&nbsp;different&nbsp;folder&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(say,&nbsp;my_client_folder)&nbsp;with&nbsp;its&nbsp;own&nbsp;axis2.xml&nbsp;file.&nbsp;my_client_folder/modules&nbsp;will&nbsp;have&nbsp;the&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;modules&nbsp;that&nbsp;the&nbsp;client&nbsp;uses<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">client_home</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_GETENV</font>(<font
color="#FF0000">"AXIS2C_HOME"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(!<font
color="#000000">client_home</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">client_home</font>&nbsp;=&nbsp;<font
color="#FF0000">"../../deploy"</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Set&nbsp;end&nbsp;point&nbsp;reference&nbsp;of&nbsp;echo&nbsp;service&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">address</font>&nbsp;=&nbsp;<font
color="#FF0000">"http://localhost:9090/axis2/services/echo"</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">wsa_action</font>&nbsp;=&nbsp;<font
color="#FF0000">"http://localhost:9090/axis2/services/echo/echoString"</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(<font
color="#000000">argc</font>&nbsp;&gt;&nbsp;<font
color="#0000FF">1</font>&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">address</font>&nbsp;=&nbsp;<font
color="#000000">argv</font>[<font color="#0000FF">1</font>];<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(<font
color="#000000">AXIS2_STRCMP</font>(<font
color="#000000">address</font>,&nbsp;<font
color="#FF0000">"-h"</font>)&nbsp;==&nbsp;<font color="#0000FF">0</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">printf</font>(<font
color="#FF0000">"Usage&nbsp;:&nbsp;%s&nbsp;[endpoint_url]\n"</font>,&nbsp;<font
color="#000000">argv</font>[<font color="#0000FF">0</font>]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">printf</font>(<font
color="#FF0000">"use&nbsp;-h&nbsp;for&nbsp;help\n"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000"><b>return</b></font>&nbsp;<font color="#0000FF">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>&nbsp;(<font
color="#FF0000">"Using&nbsp;endpoint&nbsp;:&nbsp;%s\n"</font>,&nbsp;<font
color="#000000">address</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;build&nbsp;the&nbsp;SOAP&nbsp;request&nbsp;message&nbsp;content&nbsp;using&nbsp;OM&nbsp;API.*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">node</font>&nbsp;=&nbsp;<font
color="#000000">build_om_programatically</font>(&amp;<font
color="#000000">env</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;create&nbsp;call&nbsp;struct&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">call</font>&nbsp;=&nbsp;<font
color="#000000">axis2_call_create</font>(&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;<font
color="#000000">client_home</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">mep_client</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_CALL_GET_BASE</font>(<font
color="#000000">call</font>,&nbsp;&amp;<font color="#000000">env</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Prepare&nbsp;the&nbsp;SOAP&nbsp;envelope,&nbsp;using&nbsp;the&nbsp;SOAP&nbsp;message&nbsp;content&nbsp;to&nbsp;be&nbsp;sent.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Get&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;message&nbsp;context&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">msg_ctx</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_MEP_CLIENT_PREPARE_SOAP_ENVELOPE</font>(<font
color="#000000">mep_client</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">node</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Get&nbsp;the&nbsp;reference&nbsp;to&nbsp;message&nbsp;info&nbsp;headers&nbsp;structure&nbsp;from&nbsp;the&nbsp;message&nbsp;context.&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;manipulate&nbsp;SOAP&nbsp;header&nbsp;content&nbsp;when&nbsp;using&nbsp;WS-Addressing.&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">msg_info_headers</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_MSG_CTX_GET_MSG_INFO_HEADERS</font>(<font
color="#000000">msg_ctx</font>,&nbsp;&amp;<font
color="#000000">env</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;create&nbsp;an&nbsp;axis2_endpoint_ref_t&nbsp;struct&nbsp;with&nbsp;ERP&nbsp;assigned&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">endpoint_ref</font>&nbsp;=&nbsp;<font
color="#000000">axis2_endpoint_ref_create</font>(&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">address</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Set&nbsp;header&nbsp;parameters,&nbsp;required&nbsp;for&nbsp;WS-Addressing.&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Required&nbsp;only&nbsp;if&nbsp;you&nbsp;need&nbsp;to&nbsp;make&nbsp;use&nbsp;of&nbsp;WS-Addressing.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_MSG_INFO_HEADERS_SET_TO</font>(<font
color="#000000">msg_info_headers</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#000000">endpoint_ref</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_MSG_INFO_HEADERS_SET_ACTION</font>(<font
color="#000000">msg_info_headers</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#000000">wsa_action</font>);&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_CALL_SET_TO</font>(<font
color="#000000">call</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#000000">endpoint_ref</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Get&nbsp;the&nbsp;configuration&nbsp;context&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">conf</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_CONF_CTX_GET_CONF</font>(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_SVC_CTX_GET_CONF_CTX</font>(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_MEP_CLIENT_GET_SVC_CTX</font>(<font
color="#000000">mep_client</font>,&nbsp;&amp;<font
color="#000000">env</font>),&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;<font
color="#000000">env</font>),&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;<font
color="#000000">env</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Get&nbsp;the&nbsp;echo&nbsp;service&nbsp;context&nbsp;if&nbsp;it&nbsp;is&nbsp;already&nbsp;loaded&nbsp;to&nbsp;service&nbsp;context*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">svc</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_CONF_GET_SVC</font>(<font
color="#000000">conf</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font color="#FF0000">"echo"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(<font
color="#000000">svc</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">op</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_SVC_GET_OP_WITH_NAME</font>(<font
color="#000000">svc</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#FF0000">"echoString"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000"><b>if</b></font>&nbsp;(<font color="#000000">op</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_OP_SET_MSG_EXCHANGE_PATTERN</font>(<font
color="#000000">op</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#000000">AXIS2_MEP_URI_OUT_IN</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;echo&nbsp;service&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;configuration&nbsp;context.&nbsp;We&nbsp;need&nbsp;to&nbsp;create&nbsp;the&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;operation&nbsp;and&nbsp;add&nbsp;it&nbsp;to&nbsp;service&nbsp;context.&nbsp;Then&nbsp;add&nbsp;service&nbsp;context&nbsp;into&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;configuration&nbsp;context.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_qname_t</font>&nbsp;*<font
color="#000000">op_qname</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_qname_t</font>&nbsp;*<font
color="#000000">svc_qname</font>&nbsp;=&nbsp;<font
color="#000000">axis2_qname_create</font>(&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#FF0000">"echo"</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;<font color="#000000">NULL</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">svc</font>&nbsp;=&nbsp;<font
color="#000000">axis2_svc_create_with_qname</font>(&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">svc_qname</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">op_qname</font>&nbsp;=&nbsp;<font
color="#000000">axis2_qname_create</font>(&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#FF0000">"echoString"</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;<font color="#000000">NULL</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">op</font>&nbsp;=&nbsp;<font
color="#000000">axis2_op_create_with_qname</font>(&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">op_qname</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_OP_SET_MSG_EXCHANGE_PATTERN</font>(<font
color="#000000">op</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#000000">AXIS2_MEP_URI_OUT_IN</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_SVC_ADD_OP</font>(<font
color="#000000">svc</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">op</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_CONF_ADD_SVC</font>(<font
color="#000000">conf</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">svc</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(!<font
color="#000000">op</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">printf</font>(<font
color="#FF0000">"ERROR:&nbsp;operation&nbsp;not&nbsp;present&nbsp;in&nbsp;service\n"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000"><b>return</b></font>&nbsp;-<font color="#0000FF">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Invoke&nbsp;the&nbsp;operation.&nbsp;Client&nbsp;blocks&nbsp;until&nbsp;the&nbsp;response&nbsp;message&nbsp;comes.&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Response&nbsp;message&nbsp;gets&nbsp;set&nbsp;in&nbsp;the&nbsp;response&nbsp;message&nbsp;context.<br>
&nbsp;&nbsp;&nbsp;&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">response_ctx</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_CALL_INVOKE_BLOCKING</font>(<font
color="#000000">call</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">op</font>,&nbsp;<font
color="#000000">msg_ctx</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(<font
color="#000000">response_ctx</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Get&nbsp;the&nbsp;response&nbsp;SOAP&nbsp;message&nbsp;from&nbsp;response&nbsp;message&nbsp;context&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_soap_envelope_t</font>&nbsp;*<font
color="#000000">soap_envelope</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_MSG_CTX_GET_SOAP_ENVELOPE</font>(<font
color="#000000">response_ctx</font>,&nbsp;&amp;<font
color="#000000">env</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">ret_node</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_SOAP_ENVELOPE_GET_BASE_NODE</font>(<font
color="#000000">soap_envelope</font>,&nbsp;&amp;<font
color="#000000">env</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>(<font
color="#000000">ret_node</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#808080"><i>/*&nbsp;Get&nbsp;the&nbsp;response&nbsp;value&nbsp;from&nbsp;the&nbsp;SOAP&nbsp;message&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_xml_writer_t</font>&nbsp;*<font
color="#000000">writer</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_output_t</font>&nbsp;*<font
color="#000000">om_output</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_char_t</font>&nbsp;*<font
color="#000000">buffer</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">printf</font>(<font
color="#FF0000">"\necho&nbsp;stub&nbsp;invoke&nbsp;SUCCESSFUL!\n"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">writer</font>&nbsp;=&nbsp;<font
color="#000000">axis2_xml_writer_create_for_memory</font>(&amp;<font
color="#000000">env</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;<font
color="#000000">AXIS2_TRUE</font>,&nbsp;<font color="#0000FF">0</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">om_output</font>&nbsp;=&nbsp;<font
color="#000000">axis2_om_output_create</font>&nbsp;(&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">writer</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_OM_NODE_SERIALIZE</font>&nbsp;(<font
color="#000000">ret_node</font>,&nbsp;&amp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">om_output</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">buffer</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_XML_WRITER_GET_XML</font>(<font
color="#000000">writer</font>,&nbsp;&amp;<font
color="#000000">env</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">printf</font>&nbsp;(<font
color="#FF0000">"\nReceived&nbsp;OM&nbsp;node&nbsp;in&nbsp;XML&nbsp;:&nbsp;%s\n"</font>,&nbsp;<font
color="#000000">buffer</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>else</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_LOG_ERROR</font>(<font
color="#000000">env</font>-&gt;<font color="#000000">log</font>,&nbsp;<font
color="#000000">AXIS2_LOG_SI</font>,&nbsp;<font
color="#FF0000">"Stub&nbsp;invoke&nbsp;failed:&nbsp;Error&nbsp;code:"</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#FF0000">"&nbsp;%d&nbsp;::&nbsp;%s"</font>,&nbsp;<font
color="#000000">env</font>-&gt;<font color="#000000">error</font>-&gt;<font
color="#000000">error_number</font>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_ERROR_GET_MESSAGE</font>(<font
color="#000000">env</font>-&gt;<font color="#000000">error</font>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">printf</font>(<font
color="#FF0000">"echo&nbsp;stub&nbsp;invoke&nbsp;failed!\n"</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(<font
color="#000000">call</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_CALL_FREE</font>(<font
color="#000000">call</font>,&nbsp;&amp;<font color="#000000">env</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>return</b></font>&nbsp;<font
color="#000000">status</font>;<br>
}<br>
<br>
<font
color="#808080"><i>/*&nbsp;build&nbsp;SOAP&nbsp;request&nbsp;message&nbsp;content&nbsp;using&nbsp;OM&nbsp;*/</i></font><br>
<font color="#000000">axis2_om_node_t</font>&nbsp;*<br>
<font color="#000000">build_om_programatically</font>(<font
color="#000000">axis2_env_t</font>&nbsp;**<font
color="#000000">env</font>)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_node_t</font>&nbsp;*<font
color="#000000">echo_om_node</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_element_t</font>*&nbsp;<font
color="#000000">echo_om_ele</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_node_t</font>*&nbsp;<font
color="#000000">text_om_node</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_element_t</font>&nbsp;*&nbsp;<font
color="#000000">text_om_ele</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_namespace_t</font>&nbsp;*<font
color="#000000">ns1</font>&nbsp;=&nbsp;<font color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_xml_writer_t</font>&nbsp;*<font
color="#000000">xml_writer</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">axis2_om_output_t</font>&nbsp;*<font
color="#000000">om_output</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">axis2_char_t</font>&nbsp;*<font
color="#000000">buffer</font>&nbsp;=&nbsp;<font
color="#000000">NULL</font>;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">ns1</font>&nbsp;=&nbsp;<font
color="#000000">axis2_om_namespace_create</font>&nbsp;(<font
color="#000000">env</font>,&nbsp;<font
color="#FF0000">"http://localhost:9090/axis2/services/echo"</font>,&nbsp;<font
color="#FF0000">"ns1"</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">echo_om_ele</font>&nbsp;=&nbsp;<font
color="#000000">axis2_om_element_create</font>(<font
color="#000000">env</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;<font
color="#FF0000">"echoString"</font>,&nbsp;<font
color="#000000">ns1</font>,&nbsp;&amp;<font
color="#000000">echo_om_node</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">text_om_ele</font>&nbsp;=&nbsp;<font
color="#000000">axis2_om_element_create</font>(<font
color="#000000">env</font>,&nbsp;<font
color="#000000">echo_om_node</font>,&nbsp;<font
color="#FF0000">"text"</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;&amp;<font
color="#000000">text_om_node</font>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_OM_ELEMENT_SET_TEXT</font>(<font
color="#000000">text_om_ele</font>,&nbsp;<font
color="#000000">env</font>,&nbsp;<font
color="#FF0000">"echo5"</font>,&nbsp;<font
color="#000000">text_om_node</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">xml_writer</font>&nbsp;=&nbsp;<font
color="#000000">axis2_xml_writer_create_for_memory</font>(<font
color="#000000">env</font>,&nbsp;<font
color="#000000">NULL</font>,&nbsp;<font
color="#000000">AXIS2_FALSE</font>,&nbsp;<font
color="#000000">AXIS2_FALSE</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">om_output</font>&nbsp;=&nbsp;<font
color="#000000">axis2_om_output_create</font>(&nbsp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">xml_writer</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font
color="#000000">AXIS2_OM_NODE_SERIALIZE</font>(<font
color="#000000">echo_om_node</font>,&nbsp;<font
color="#000000">env</font>,&nbsp;<font color="#000000">om_output</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">buffer</font>&nbsp;=&nbsp;<font
color="#000000">AXIS2_XML_WRITER_GET_XML</font>(<font
color="#000000">xml_writer</font>,&nbsp;<font
color="#000000">env</font>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font
color="#FF0000">"\nSending&nbsp;OM&nbsp;node&nbsp;in&nbsp;XML&nbsp;:&nbsp;%s&nbsp;\n"</font>,&nbsp;&nbsp;<font
color="#000000">buffer</font>);&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>return</b></font>&nbsp;<font
color="#000000">echo_om_node</font>;<br>
}<br>
</p>

<h4><a name="Request_SOAP_Message">Request SOAP Message</a></h4>
<pre class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"&gt;
      &lt;soapenv:Header xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing"&gt;
         &lt;wsa:To&gt;http://localhost:9090/axis2/services/echo/echo&lt;/wsa:To&gt;
         &lt;wsa:Action&gt;http://127.0.0.1:9090/axis2/services/echo/echoString&lt;/wsa:Action&gt;
         &lt;wsa:ReplyTo&gt;
            &lt;wsa:Address&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/wsa:Address&gt;
         &lt;/wsa:ReplyTo&gt;
         &lt;wsa:ReferenceProperties&gt;&lt;/wsa:ReferenceProperties&gt;
         &lt;wsa:MessageID&gt;325699d4-a438-1da1-3e0b-001125b4e529&lt;/wsa:MessageID&gt;
      &lt;/soapenv:Header&gt;
      &lt;soapenv:Body&gt;
         &lt;ns1:echoString xmlns:ns1="http://localhost:9090/axis2/services/echo"&gt;
            &lt;text&gt;Hello World!&lt;/text&gt;
         &lt;/ns1:echoString&gt;
      &lt;/soapenv:Body&gt;
   &lt;/soapenv:Envelope&gt;</pre>

<h4><a name="Response_SOAP_Message">Response SOAP Message</a></h4>
<pre class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"&gt;
      &lt;soapenv:Header xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing"&gt;
         &lt;wsa:To&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/wsa:To&gt;
         &lt;wsa:Action&gt;http://127.0.0.1:9090/axis2/services/echo/echoString&lt;/wsa:Action&gt;
         &lt;wsa:ReplyTo&gt;
            &lt;wsa:Address&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/wsa:Address&gt;
         &lt;/wsa:ReplyTo&gt;
         &lt;wsa:ReferenceProperties&gt;&lt;/wsa:ReferenceProperties&gt;
         &lt;wsa:From&gt;
            &lt;wsa:Address&gt;http://localhost:9090/axis2/services/echo/echo&lt;/wsa:Address&gt;
         &lt;/wsa:From&gt;
         &lt;wsa:ReferenceProperties&gt;&lt;/wsa:ReferenceProperties&gt;
         &lt;wsa:MessageID&gt;326a1946-a438-1da1-2b95-001125b4e529&lt;/wsa:MessageID&gt;
         &lt;wsa:RelatesTo wsa:RelationshipType="wsa:Reply"&gt;325699d4-a438-1da1-3e0b-001125b4e529&lt;/wsa:RelatesTo&gt;
      &lt;/soapenv:Header&gt;
      &lt;soapenv:Body&gt;
         &lt;ns1:echoString xmlns:ns1="http://localhost:9090/axis2/services/echo"&gt;
            &lt;text&gt;Hello World!&lt;/text&gt;
         &lt;/ns1:echoString&gt;
      &lt;/soapenv:Body&gt;
   &lt;/soapenv:Envelope&gt;</pre>
<br>


<p>Echo NonBlocking Client</p>

<p>In the Echo Blocking Client exmple above, once the
"axis2_echo_stub_echo(stub, &amp;env, node);" is called, the client is
blocked till the operation is completed. This behavior is not desirable when
there are many Web Service invocations to be done in a single client
application. A solution would be to use a Non-Blocking API to invoke web
services. Axis2 provides a callback based non-blocking API for users.</p>

<p>A Sample demonstrating this senario can be found in the
samples/client/echo_non_blocking folder. In fact, this sample demonstrates
one level below the usual callback mechanism.</p>

<p>Before we look at the code changes to the Echo Blocking Client,, let's get
a feel of how it works. First You need to create a callback instance using
axis2_callback_create(axis2_env_t*) and then call the macro
AXIS2_CALL_INVOKE_NON_BLOCKING(axis2_call_t*, axis2_env_t**,
axis2_msg_ctx_t*, axis2_callback_t*). In your code, you need to poll using
the macro AXIS2_CALLBACK_GET_COMPLETE(axis2_callback_t*, axis2_env_t**) to
check for the completion. Once this macro is true, you can access the reply
SOAP payload using the macro AXIS2_CALLBACK_GET_ENVELOPE(axis2_callback_t*,
axis2_env_t**).</p>

<p></p>

<p>You need to primarily replace the following portion of code in the Echo
Blocking Client</p>
<pre>&nbsp;&nbsp;&nbsp;&nbsp;stub&nbsp;=&nbsp;<font color="#000000">axis2_stub_create_with_endpoint_uri_and_client_home</font>(&amp;<font color="#000000">env</font>,&nbsp;<font color="#000000">address</font>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">client_home</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_STUB_SET_TRANSPORT_INFO</font>(<font color="#000000">stub</font>,&nbsp;&amp;<font color="#000000">env</font>,&nbsp;<font color="#000000">AXIS2_TRANSPORT_HTTP</font>,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_TRANSPORT_HTTP</font>,&nbsp;<font color="#000000">AXIS2_FALSE</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_STUB_SET_SOAP_VERSION</font>(<font color="#000000">stub</font>,&nbsp;&amp;<font color="#000000">env</font>,&nbsp;<font color="#000000">AXIS2_SOAP_11</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080"><i>/*&nbsp;create&nbsp;node&nbsp;and&nbsp;invoke&nbsp;echo&nbsp;*/</i></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">ret_node</font>&nbsp;=&nbsp;<font color="#000000">axis2_echo_stub_echo</font>(<font color="#000000">stub</font>,&nbsp;&amp;<font color="#000000">env</font>,&nbsp;<font color="#000000">node</font>);<br>
        </pre>

<p>to the following (note that you need to create an instance of
axis2_callback_t.</p>

<p> </p>
<pre>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">callback &nbsp;=&nbsp;axis2_callback_create</font>(&amp;<font color="#000000">env</font>);<br>
<font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;AXIS2_CALL_INVOKE_NON_BLOCKING</font>(<font color="#000000">call</font>,&nbsp;&amp;<font color="#000000">env</font>,&nbsp;<font color="#000000">op</font>,&nbsp;<font color="#000000">msg_ctx</font>,&nbsp;<font color="#000000">callback</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>while</b></font>&nbsp;(!<font color="#000000">AXIS2_CALLBACK_GET_COMPLETE</font>(<font color="#000000">callback</font>,&nbsp;&amp;<font color="#000000">env</font>))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">printf</font>(<font color="#FF0000">"sleep(2)&nbsp;till&nbsp;callback&nbsp;complete\n"</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>if</b></font>&nbsp;(<font color="#000000">count</font>++&nbsp;&gt;&nbsp;<font color="#0000FF">10</font>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000"><b>break</b></font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">AXIS2_SLEEP</font>(<font color="#0000FF">2</font>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">soap_envelope</font>&nbsp;=&nbsp;<font color="#000000">AXIS2_CALLBACK_GET_ENVELOPE</font>(<font color="#000000">callback</font>,&nbsp;&amp;<font color="#000000">env</font>);<br></pre>

<p></p>

<p align="right"><a href="userguide1.html"><img src="images/arrow_left.gif">
Previous</a> | <a href="userguide3.html">Next <img
src="images/arrow_right.gif"></a></p>

<p>Pages: <a href="userguide.html">Content</a>, <a
href="userguide1.html">1</a>, <b>2</b>, <a href="userguide3.html">3</a></p>
</body>
</html>
